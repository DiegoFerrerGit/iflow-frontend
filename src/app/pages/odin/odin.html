<main class="w-full flex flex-col items-center pb-32">
    <app-banner class="w-full shrink-0"></app-banner>

    <div class="w-full max-w-6xl mx-auto px-6 mt-12 flex flex-col items-center">
        <!-- Incomes Section Header -->
        <div class="w-full flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold text-white tracking-wide uppercase">Fuentes de Ingreso</h2>
            <button
                class="flex items-center gap-2 bg-primary/20 hover:bg-primary/30 text-primary px-4 py-2 rounded-xl transition-colors text-sm font-bold border border-primary/20">
                <span class="material-symbols-outlined text-[18px]">add</span>
                AÃ±adir fuente
            </button>
        </div>

        <!-- Incomes Grid -->
        <div class="w-full grid grid-cols-1 md:grid-cols-3 gap-6 relative z-20">
            @for (income of incomes; track income.id) {
            <app-income-card [income]="income"></app-income-card>
            }
        </div>

        <!-- Incomes to Pool Flow -->
        <div class="w-full max-w-2xl mx-auto -mt-3 relative z-10 flex justify-center py-6 h-[120px] overflow-visible">
            <svg viewBox="0 0 1000 120" class="w-[100%] h-full overflow-visible absolute top-0"
                preserveAspectRatio="none">
                <defs>
                    <filter id="glow-flow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="4" result="blur" />
                        <feMerge>
                            <feMergeNode in="blur" />
                            <feMergeNode in="SourceGraphic" />
                        </feMerge>
                    </filter>
                    <style>
                        .animated-path {
                            stroke-dasharray: 8 12;
                            animation: dash-flow 2s linear infinite;
                        }

                        @keyframes dash-flow {
                            to {
                                stroke-dashoffset: -100;
                            }
                        }
                    </style>
                </defs>

                @for (income of incomes; track income; let i = $index) {
                <!-- Background Track -->
                <path
                    [attr.d]="'M ' + (((1000 / incomes.length) * i) + ((1000 / incomes.length) / 2)) + ' 0 C ' + (((1000 / incomes.length) * i) + ((1000 / incomes.length) / 2)) + ' 60, 500 60, 500 120'"
                    fill="none" stroke="#22c55e" stroke-width="2" opacity="0.15" stroke-linecap="round" />

                <!-- Animated flow -->
                <path
                    [attr.d]="'M ' + (((1000 / incomes.length) * i) + ((1000 / incomes.length) / 2)) + ' 0 C ' + (((1000 / incomes.length) * i) + ((1000 / incomes.length) / 2)) + ' 60, 500 60, 500 120'"
                    fill="none" stroke="#22c55e" stroke-width="3" class="animated-path" filter="url(#glow-flow)"
                    stroke-linecap="round" />

                <!-- Source Dots -->
                <circle [attr.cx]="(((1000 / incomes.length) * i) + ((1000 / incomes.length) / 2))" cy="0" r="5"
                    fill="#4ade80" filter="url(#glow-flow)" />
                }

                <!-- Target Pool Entry Dot -->
                <circle cx="500" cy="120" r="7" fill="#4ade80" filter="url(#glow-flow)" />
            </svg>
        </div>

        <!-- Total Pool Central Card -->
        <div
            class="w-full max-w-2xl mx-auto bg-sidebar-bg border border-white/10 rounded-[32px] p-8 relative z-20 flex items-center justify-between shadow-2xl mt-4 
            before:absolute before:inset-0 before:rounded-[32px] before:bg-gradient-to-t before:from-primary/10 before:to-transparent before:pointer-events-none overflow-hidden group">

            <!-- Shimmer effect overlay -->
            <div
                class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full group-hover:animate-[shimmer_2s_infinite]">
            </div>

            <!-- Left side: Icon/Chart placeholder -->
            <div class="flex items-center gap-8 relative z-10">
                <!-- Circular Segment Graphic -->
                <div class="relative w-28 h-28 flex items-center justify-center shrink-0">
                    <svg class="w-full h-full transform -rotate-90 drop-shadow-[0_0_15px_rgba(168,85,247,0.4)]"
                        viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="42" fill="none" class="stroke-white/5" stroke-width="8"></circle>
                        <circle cx="50" cy="50" r="42" fill="none" class="stroke-primary" stroke-width="8"
                            stroke-dasharray="263.89" stroke-dashoffset="52.7"></circle>
                    </svg>
                    <div
                        class="absolute inset-0 flex items-center justify-center bg-primary/10 rounded-full m-4 border border-primary/20 backdrop-blur-md">
                        <span class="material-symbols-outlined text-primary text-4xl">inventory_2</span>
                    </div>
                </div>

                <div>
                    <h3 class="text-slate-400 text-xs font-black tracking-[0.2em] uppercase mb-2">Pozo Total</h3>
                    <div class="flex items-baseline gap-1.5">
                        <span class="text-primary text-2xl font-black">$</span>
                        <span class="text-white text-[56px] leading-none font-black tracking-tighter">14,500</span>
                    </div>
                    <p
                        class="text-primary text-[10px] font-black uppercase mt-3 tracking-widest bg-primary/10 inline-flex items-center px-3 py-1.5 rounded-lg border border-primary/20">
                        <span class="w-1.5 h-1.5 rounded-full bg-primary mr-2 shadow-[0_0_8px_currentColor]"></span>
                        100% Retorno Flujos
                    </p>
                </div>
            </div>

            <!-- Right side: Actions -->
            <div class="flex flex-col gap-3 relative z-10">
                <button
                    class="w-12 h-12 rounded-2xl bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white flex items-center justify-center transition-colors border border-white/5 hover:border-white/20">
                    <span class="material-symbols-outlined text-xl">settings</span>
                </button>
                <button
                    class="w-12 h-12 rounded-2xl bg-primary/10 hover:bg-primary/20 text-primary flex items-center justify-center transition-colors border border-primary/20 hover:border-primary/40">
                    <span class="material-symbols-outlined text-xl">account_balance_wallet</span>
                </button>
            </div>
        </div>
    </div>
</main>